// Generated by CoffeeScript 1.10.0
var CozyInstance, americano;

americano = require('cozydb');

module.exports = CozyInstance = americano.getModel('CozyInstance', {
  id: String,
  domain: String,
  locale: String,
  connectedOnce: Boolean,
  background: String
});

CozyInstance.first = function(callback) {
  return CozyInstance.request('all', function(err, instances) {
    if (err) {
      return callback(err);
    } else if (!instances || instances.length === 0) {
      return callback(null, null);
    } else {
      return callback(null, instances[0]);
    }
  });
};

CozyInstance.getLocale = function(callback) {
  return CozyInstance.request('all', function(err, instances) {
    var ref;
    if (err) {
      console.log(err);
    }
    return callback(null, (instances != null ? (ref = instances[0]) != null ? ref.locale : void 0 : void 0) || 'en');
  });
};

CozyInstance.getURL = function(callback) {
  return CozyInstance.first(function(err, instance) {
    var url;
    if (err) {
      return callback(err);
    } else if (instance != null ? instance.domain : void 0) {
      url = instance.domain.replace('http://', '').replace('https://', '');
      return callback(null, "https://" + url + "/");
    } else {
      return callback(new Error('No instance domain set'));
    }
  });
};
